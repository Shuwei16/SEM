<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Database</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
</head>
<body>
    <h1 class="text-center">HERE IS THE QUESTIONS STATUS PAGE</h1>
    <div class="mx-5">
        <div id="searchResultContainer" class="mt-5">
            <% if (Array.isArray(quesList) && quesList.length > 0) { %>
                <h3>Total Results: <%= quesList.length %></h3>
                <table class="table table-hover" style="width:90%">
                    <thead>
                        <tr>
                            <h4 class="text-center">Questions List</h4>
                        </tr>
                        <tr>
                            <th scope="col-md-auto">Questioner's Name</th>
                            <th scope="col-md-auto">Questioner's Phone Number</th>
                            <th scope="col-md-auto">Questioner's Email</th>
                            <th scope="col-md-auto">Questions</th>
                            <th scope="col-md-auto">Status</th>
                            <th scope="col-md-auto">Check</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% quesList.forEach(ques => { %>
                            <tr>
                                <td scope="col"><%= ques.name %></td>
                                <td scope="col"><%= ques.phoneNum %></td>
                                <td scope="col"><%= ques.email %></td>
                                <td scope="col"><%= ques.question %></td>
                                <td scope="col"><%= ques.status %></td>
                                <td scope="col">
                                    <% if (ques.status === 'Pending') { %>
                                        <button class="btn btn-primary" onclick="changeStatus('<%= ques.name %>')">Solved</button>
                                    <% } else { %>
                                        <button class="btn btn-primary" disabled>Solved</button>
                                    <% } %>
                                </td>
                            </tr>
                        <% })  %>
                    </tbody>
                </table>
            <% } else { %>
                <p>No questions found.</p>
            <% } %>
        </div>

        <div class="text-center my-5">
            <a href="/"><button class="btn btn-primary">Back</button></a>
        </div>
    </div>

    <script>
    async function changeStatus(name) {
        try {
            alert('This question have been marked as Solved! Thanks for responding.');
            const response = await fetch('/updateStatus', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({name}),
            });
            window.location.reload();
        } catch (error) {
            console.error("Error updating question status:", error);
        }
    }
    </script>

</body>
</html>
